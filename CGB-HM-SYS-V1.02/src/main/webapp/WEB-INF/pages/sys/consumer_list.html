
<div class="row">
	<div class="col-md-3 col-sm-6 col-xs-12">
		<div class="info-box">
			<span class="info-box-icon bg-aqua"><i
				class="glyphicon glyphicon-glass"></i></span>

			<div class="info-box-content">
				<span class="info-box-text">饮品库存数</span> <span
					class="info-box-number">1,410</span>
			</div>
			<!-- /.info-box-content -->
		</div>
		<!-- /.info-box -->
	</div>
	<!-- /.col -->
	<div class="col-md-3 col-sm-6 col-xs-12">
		<div class="info-box">
			<span class="info-box-icon bg-green"><i class="fa fa-cutlery"></i></span>

			<div class="info-box-content">
				<span class="info-box-text">食品库存数</span> <span
					class="info-box-number">1,120</span>
			</div>
			<!-- /.info-box-content -->
		</div>
		<!-- /.info-box -->
	</div>
	<!-- /.col -->
	<div class="col-md-3 col-sm-6 col-xs-12">
		<div class="info-box">
			<span class="info-box-icon bg-yellow"><i
				class="glyphicon glyphicon-user"></i></span>

			<div class="info-box-content">
				<span class="info-box-text">购买人数</span> <span
					class="info-box-number">648</span>
			</div>
			<!-- /.info-box-content -->
		</div>
		<!-- /.info-box -->
	</div>
	<!-- /.col -->
	<div class="col-md-3 col-sm-6 col-xs-12">
		<div class="info-box">
			<span class="info-box-icon bg-red"><i class="fa fa-star-o"></i></span>

			<div class="info-box-content">
				<span class="info-box-text">好评数</span> <span class="info-box-number">439</span>
			</div>
			<!-- /.info-box-content -->
		</div>
		<!-- /.info-box -->
	</div>
	<!-- /.col -->
</div>

<div class="row">
	<div class="col-md-3">
		<!-- /. box -->
		<div class="box box-solid">
			<div class="box box-primary">
				<div class="box-header with-border">
					<h3 class="box-title">
						<font style="vertical-align: inherit;"><font
							style="vertical-align: inherit;">购物者信息查询</font></font>
					</h3>
				</div>
				<!-- /.box-header -->
				<!-- form start -->
				<form role="form">
					<div class="box-body">
						<div class="form-group">
							<label for="exampleInputPassword1"><font
								style="vertical-align: inherit;"><font
									style="vertical-align: inherit;">名字</font></font></label> <input type="text"
								class="form-control" id="exampleInputPassword1">
						</div>

						<div class="form-group">
							<label for="exampleInputPassword1"><font
								style="vertical-align: inherit;"><font
									style="vertical-align: inherit;">手机号</font></font></label> <input type="text"
								class="form-control" id="exampleInputPassword1">
						</div>
					</div>
					<!-- /.box-body -->

					<div class="box-footer">
						<button type="submit" class="btn btn-primary">查询用户</button>
						<button type="submit" class="btn btn-danger">清空购物车</button>
						<label> <input type="checkbox"> 消费规则 <a href="#">先货后款</a>
						</label>
					</div>
				</form>
			</div>
		</div>
		<!-- /.form group -->
		<div class="box box-primary">
			<div class="box-header with-border">
				<h3 class="box-title">最近添加商品</h3>
			</div>
			<!-- /.box-header -->
			<div class="box-body">
				<ul class="products-list product-list-in-box">
					<li class="item">
						<div class="product-img">
							<img src="dist/img/可乐.jpg" alt="Product Image">
						</div>
						<div class="product-info">
							<a href="javascript:void(0)" class="product-title">可乐 <span
								class="label label-warning pull-right">2元</span>
							</a>
						</div>
					</li>
					<!-- /.item -->
					<li class="item">
						<div class="product-img">
							<img src="dist/img/早餐套餐A.jpg" alt="Product Image">
						</div>
						<div class="product-info">
							<a href="javascript:void(0)" class="product-title">早餐套餐A <span
								class="label label-info pull-right">20元</span>
							</a>
						</div>
					</li>
					<!-- /.item -->
					<li class="item">
						<div class="product-img">
							<img src="dist/img/芙蓉王.jpg" alt="Product Image">
						</div>
						<div class="product-info">
							<a href="javascript:void(0)" class="product-title">芙蓉王 <span
								class="label label-danger pull-right">26元</span>
							</a>
						</div>
					</li>
					<!-- /.item -->
					<li class="item">
						<div class="product-img">
							<img src="dist/img/康师傅老坛酸菜牛肉面.jpg" alt="Product Image">
						</div>
						<div class="product-info">
							<a href="javascript:void(0)" class="product-title">康师傅老坛酸菜牛肉面
								<span class="label label-default pull-right">4元</span>
							</a>
						</div>
					</li>
					<!-- /.item -->
				</ul>
			</div>
			<!-- /.box-body -->
			<div class="box-footer text-center">
				<a href="javascript:void(0)" class="uppercase">View All Products</a>
			</div>
			<!-- /.box-footer -->
		</div>
	</div>
	<!-- /.box-body -->

	<!-- /.box -->



	<div class="col-md-9">
		<div class="box">
			<div class="box-header">
				<h3 class="box-title">外卖零单消费界面</h3>

				<div class="box-tools">
					<div class="input-group input-group-sm" style="width: 350px;">
						<input type="text" name="table_search" id="searchNameId"
							class="form-control pull-right" placeholder="商品名">

						<div class="input-group-btn">
							<button type="button" class="btn btn-default btn-search">
								<i class="fa fa-search"></i>
							</button>
							<button type="button" class="btn btn-default btn-insert">下单</button>
							<button type="button" class="btn btn-default btn-add">增加商品</button>
							<button type="button" class="btn btn-default btn-delete">删除商品</button>
						</div>
					</div>
				</div>
			</div>
			<!-- /.box-header -->
			<div class="box-body table-responsive no-padding">
				<table class="table table-hover">
					<thead>
						<tr>
							<th><input type="checkbox" id="checkAll">全选</th>
							<th>商品</th>
							<th>单价</th>
							<th>数量</th>
							<th>小计</th>
						</tr>
					</thead>
					<tbody id="tbodyId">
						<tr>
							<td colspan="7">数据正在加载中....</td>
						</tr>
					</tbody>
				</table>
			</div>
			<div id="pageId" class="box-footer clearfix">
				<!-- 加载分页页面 -->
			</div>
			<!-- /.box-body -->
		</div>
		<!-- /.box -->
	</div>
</div>
<script type="text/javascript">
	$(function() {
		$("#pageId").load("doPageUI.do", function() {
			doGetObjects();
		});
		$(".input-group-btn").on("click", ".btn-search", doQueryObjects).on(
				"click", ".btn-delete", doDeleteObjects).on("click",
				".btn-insert", doInsertData).on("click", ".btn-add",
				doLoadEditUI)
		$("thead").on("change", "#checkAll", doChangeTBodyCheckBoxState);
		$("#tbodyId").on("change", '.cBox', doChangeTHeadCheckBoxState).on(
				"click", '.jian', doJian).on("click", '.jia', doJia);

	})
	//加载编辑页面
	function doLoadEditUI() {
		var title;
		//1.基于点击对象的class设置title的值
		if ($(this).hasClass("btn-add")) {
			title = "添加商品信息";
		}
		//2.发异步请求加载页面
		var url = "consumer/doConsumerEditUI.do";
		$("#mainContentId").load(url, function() {
			//修改编辑页面标题(html函数为jquery自带,
			//用于在某个位置填充内容)
			$(".box-title").html(title);
		});
	}
	function doJian() {
		var val = parseInt($(this).next("input").val());
		if (val > 0) {
			$(this).next("input").val(val - 1);
			var a = $(this).next("input").val();
			var b = $(this).parent().prev("td").text();
			var c = a * b;
			$(this).parent().next("td").children().val(c);

		}

	}

	function doJia() {
		var val = parseInt($(this).prev("input").val());
		$(this).prev("input").val(val + 1);
		var a = $(this).prev("input").val();
		var b = $(this).parent().prev("td").text();
		var c = a * b;
		$(this).parent().next("td").children().val(c);
	}

	function doGetCheckedId() {
		return $("tbody input[name='radioId']:checked").val();
	}
	function doGetObjects() {
		//1.定义url和参数
		var url = "consumer/doFindPageObjects.do"
		var pageCurrent = $("#pageId").data("pageCurrent");
		if (!pageCurrent)
			pageCurrent = 1;
		var params = {
			"pageCurrent" : pageCurrent
		};
		var username = $("#searchNameId").val();
		if (username)
			params.username = username;
		//2.发起以不请求
		$.getJSON(url, params, function(result) {
			doHandleResponseResult(result);
		})
	}

	function doHandleResponseResult(result) {
		if (result.state == 1) {
			doSetTableBodyRows(result.data.records);
			doSetPagination(result.data);
		} else {
			alert(result.msg);
		}
	}

	function doSetTableBodyRows(records) {
		var tBody = $("#tbodyId");
		tBody.empty();
		for ( var i in records) {
			var tr = $("<tr></tr>");
			var tds = doCreateTds(records[i]);
			tr.append(tds);
			tBody.append(tr);
		}
	}

	function doCreateTds(data) {
		var tds = "<td><input type='checkbox' class='cBox' name='cItem' value='"+data.id+"'></td>"
				+ "<td>"
				+ data.goods
				+ "</td>"
				+ "<td>"
				+ data.price
				+ "</td>"
				+ "<td>"
				+ "<input type='button' class='jian' value='-'></input>"
				+ "<input class='num' type='text' style='width: 20px;text-align: center;'value='0' readonly='readonly'/></input>"
				+ "<input type='button' class='jia' value='+'></input>"
				+ "</td>"
				+ "<td>"
				+ "<input class='sum' type='text' style='width: 80px;text-align: center;'value='0' readonly='readonly'/></input>"
				+ "</td>";
		return tds;
	}

	function doQueryObjects() {
		$("#pageId").data("pageCurrent", 1);
		doGetObjects();
	}

	function doChangeTHeadCheckBoxState() {
		var flag = true;
		$("#tbodyId input[name='cItem']").each(function() {
			flag = flag && $(this).prop("checked")
		});
		$("checkAll").prop("checked", flag);
	}

	function doChangeTBodyCheckBoxState() {
		var flag = $(this).prop("checked");
		$("#tbodyId input[name='cItem']").prop("checked", flag);
	}

	function doDeleteObjects() {
		var ids = doGetCheckedIds();
		if (ids.length == 0) {
			alert("至少选择一个");
			return;
		}
		if (!confirm("确认删除吗？"))
			return;
		var url = "consumer/doDeleteObjects.do";
		var params = {
			"ids" : ids.toString()
		};
		console.log(params);
		$.post(url, params, function(result) {
			if (result.state == 1) {
				alert(result.message);
				doGetObjects();
			} else {
				alert(result.message);
			}
		});
	}

	function doGetCheckedIds() {
		var array = [];
		$("#tbodyId input[type=checkbox]").each(function() {
			if ($(this).prop("checked")) {
				array.push($(this).val());
			}
		});
		return array;
	}
	function doInsertData() {
		var AllData = doGetCheckedAllData();
		/* AllData = JSON.stringify("AllData":AllData) */
		// console.log(AllData);
		if (AllData.length == 0) {
			alert("至少选择一个");
			return;
		} else {
			var a = prompt("请输入房号")
			//AllData.roomNum=a.toString();
			var jsonStr = JSON.stringify(AllData);
			console.log(AllData);
			//var jsonStr=JSON.stringify(AllData);
			var url = "consumer/doConsumerSaveData.do";
			$.post(url, {
				'json' : jsonStr,
				'roomId' : a
			}, function(result) {
				if (result.state == 1) {
					alert(result.message);
					doCancel();
				} else {
					alert(result.message);
				}
			})
		}

		/* $.ajax({
			url : "consumer/doConsumerSaveData.do",
			data : JSON.stringify(AllData),
			type : 'POST',
			contentType: "application/json",
			dataType : 'json',
			success : function(result) {
				 if(result.state==1){
					 alert(result.message);
					 doCancel();
				 }else{
					alert(result.message);
				 }}
		})console.log(AllData); */

	}
	function doCancel() {
		$("#mainContentId").load("consumer/doConsumerListUI.do");
	}
	function doGetCheckedAllData() {
		var AllData = new Array();
		$("#tbodyId input[type=checkbox]").each(
				function() {
					if ($(this).prop("checked")) {
						var params = {
							goods : $(this).parent().next("td").text(),
							number : $(this).parent().next("td").next("td")
									.next("td").children(".num").val(),
							goodsmoney : $(this).parent().next("td").next("td")
									.next("td").next("td").children().val(),
						}
						AllData.push(params);
					}
				});
		return AllData;
	}
</script>